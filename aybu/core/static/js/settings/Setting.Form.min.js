Ext.ns("settings");settings.SettingForm=Ext.extend(Ext.form.FormPanel,{constructor:function(a){this.win=a.win;this.setting=a.setting;a.defaults={anchor:"90%",xtype:"textfield"};settings.SettingForm.superclass.constructor.call(this,a);this.isUpdate=false;this.waitMsg="Salvo...";this.submit_url=urls.create;this.related=[]},initComponent:function(){var b={layout:"form",padding:10,labelWidth:80};var a=new Ext.form.TextField({id:"name",name:"name",readOnly:true,fieldLabel:"Nome",allowBlank:false});if(this.setting.setting_type_name=="html"){var c=new Ext.form.HtmlEditor({id:"value",name:"value",fieldLabel:"Valore",allowBlank:false,enableLists:false})}else{if(this.setting.setting_type_name=="txt"||this.setting.setting_type_name=="image"){if(this.setting.raw_type=="int"){var c=new Ext.form.NumberField({id:"value",name:"value",fieldLabel:"Valore",allowBlank:false})}else{var c=new Ext.form.TextField({id:"value",name:"value",fieldLabel:"Valore",allowBlank:false})}}else{if(this.setting.setting_type_name=="checkbox"){var c=new Ext.form.Checkbox({id:"value",name:"value",fieldLabel:"Valore",allowBlank:false})}}}this.items=[a,c];this.buttons=[{id:"reset",text:"Reset",handler:this.reset,scope:this},{id:"submit",text:"Salva",handler:this.submit,scope:this}];Ext.apply(this,Ext.apply(this.initialConfig,b));settings.SettingForm.superclass.initComponent.call(this)},reset:function(){if(this.isUpdate){this.load(this.id)}else{this.getForm().reset()}},submit:function(){this.getForm().submit({url:this.submit_url,success:this.submit_success,failure:this.submit_failure,scope:this,clientValidation:true,waitMsg:this.waitMsg})},submit_success:function(a,b){Ext.Msg.show({title:"Impostazione Salvata",msg:"Impostazione salvata con successo.",icon:Ext.MessageBox.INFO,buttons:Ext.Msg.OK,fn:this.reload_window})},reload_window:function(){window.location.reload(true)},submit_failure:function(a,b){switch(b.failureType){case Ext.form.Action.CLIENT_INVALID:Ext.Msg.alert("Validazione","Errore di validazione dei campi");break;default:Ext.Msg.alert("Richiesta fallita",b.result.errors.exception);break}},load:function(a){this.name=a.name;this.setting=a;options={url:urls.info,params:{name:this.name},success:this.load_success,failure:this.load_error,scope:this,waitMsg:"Carico..."};this.getForm().load(options)},load_success:function(a,b){},setUpdate:function(a){this.isUpdate=true;this.waitMsg="Aggiorno...";this.submit_url=urls.update;this.enable()}});